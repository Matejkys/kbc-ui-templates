{
  "definitions": {
    "job": {
      "type": "object",
      "title": "Job",
      "headerTemplate": "{{ i1 }}: {{self.endpoint}}",
      "properties": {
        "endpoint": {
          "type": "string",
          "minLength": 1
        },
        "method": {
          "type": "string",
          "enum": [
            "GET",
            "POST",
            "FORM"
          ]
        },
        "dataType": {
          "type": "string",
          "description": "Name the destination table and data type of results",
          "title": "Data type"
        },
        "dataField": {
          "type": "string",
          "description": "Allows to override which field of the response will be exported",
          "title": "Data field"
        },
        "params": {
          "type": "object",
          "format": "table",
          "title": "Query parameters",
          "additionalProperties": {
            "$ref": "#/definitions/param"
          }
        },
        "children": {
          "type": "array",
          "title": "Child Jobs",
          "uniqueItems": true,
          "items": {
            "$ref": "#/definitions/job"
          }
        }
      }
    },
    "childJob": {
      "allOf": [
        {
          "$ref": "#/definitions/job"
        },
        {
          "properties": {
            "placeholders": {
              "type": "object",
              "format": "table",
              "title": "Placeholders"
            },
            "recursionFilter": {
              "type": "string",
              "title": "Recursion Filter",
              "description": "Can contain a value consisting of a name of a field from the parent's response, logical operator and a value to compare against. Supported operators are \"==\", \"<\", \">\", \"<=\", \">=\", \"!=\""
            }
          }
        }
      ]
    },
    "function": {
      "title": "Function",
      "oneOf": [
        {
          "$ref": "#/definitions/fn_md5"
        },
        {
          "$ref": "#/definitions/fn_sha1"
        },
        {
          "$ref": "#/definitions/fn_time"
        },
        {
          "$ref": "#/definitions/fn_date"
        },
        {
          "$ref": "#/definitions/fn_strtotime"
        },
        {
          "$ref": "#/definitions/fn_base64_encode"
        },
        {
          "$ref": "#/definitions/fn_hash_hmac"
        },
        {
          "$ref": "#/definitions/fn_sprintf"
        },
        {
          "$ref": "#/definitions/fn_concat"
        },
        {
          "$ref": "#/definitions/fn_implode"
        }
      ]
    },
    "fn_md5": {
      "type": "object",
      "title": "MD5",
      "description": "Create a MD5 hash of the parameter value",
      "properties": {
        "function": {
          "type": "string",
          "template": "md5"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "$ref": "#/definitions/param"
            }
          ],
          "additionalItems": false,
          "maxItems": 1
        }
      }
    },
    "fn_sha1": {
      "type": "object",
      "title": "SHA1",
      "description": "Create a SHA1 hash of the parameter value",
      "properties": {
        "function": {
          "type": "string",
          "template": "sha1"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "$ref": "#/definitions/param"
            }
          ],
          "additionalItems": false,
          "maxItems": 1
        }
      }
    },
    "fn_time": {
      "type": "object",
      "title": "Time",
      "description": "Return time from the beginning of the unix epoch in seconds (1.1.1970)",
      "properties": {
        "function": {
          "type": "string",
          "template": "time"
        }
      }
    },
    "fn_date": {
      "type": "object",
      "title": "Date",
      "description": "Return date in a specified format",
      "properties": {
        "function": {
          "type": "string",
          "template": "date"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "type": "string",
              "title": "Date format"
            },
            {
              "$ref": "#/definitions/param",
              "title": "Time value"
            }
          ],
          "additionalItems": false,
          "minItems": 1,
          "maxItems": 2
        }
      }
    },
    "fn_strtotime": {
      "type": "object",
      "title": "Strtotime",
      "description": "Convert a date string to number of seconds from the beginning of the unix epoch",
      "properties": {
        "function": {
          "type": "string",
          "template": "strtotime"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "title": "Time string",
              "description": "e.g.: \"-3 days\"",
              "$ref": "#/definitions/param"
            },
            {
              "title": "Timestamp - base for relative dated. \"now\" by default",
              "$ref": "#/definitions/param"
            }
          ],
          "additionalItems": false,
          "minItems": 1,
          "maxItems": 2
        }
      }
    },
    "fn_base64_encode": {
      "type": "object",
      "title": "Base64_encode",
      "description": "Encodes data with MIME base64",
      "properties": {
        "function": {
          "type": "string",
          "template": "base64_encode"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "$ref": "#/definitions/param"
            }
          ],
          "additionalItems": false,
          "maxItems": 1
        }
      }
    },
    "fn_hash_hmac": {
      "type": "object",
      "title": "hash_hmac",
      "description": "Generate a keyed hash value using the HMAC method",
      "properties": {
        "function": {
          "type": "string",
          "template": "hash_hmac"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "type": "string",
              "title": "Hashing algorithm"
            },
            {
              "title": "Data",
              "$ref": "#/definitions/param"
            },
            {
              "type": "string",
              "title": "Shared secret key",
              "description": "Shared secret key used for generating the HMAC variant of the message digest."
            },
            {
              "type": "boolean",
              "title": "Raw"
            }
          ],
          "additionalItems": false,
          "minItems": 3
        }
      }
    },
    "fn_sprintf": {
      "type": "object",
      "title": "Sprintf",
      "properties": {
        "function": {
          "type": "string",
          "template": "hash_hmac"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "type": "string",
              "title": "Format"
            }
          ],
          "additionalItems": {
            "title": "Data",
            "$ref": "#/definitions/param"
          },
          "minItems": 1
        }
      }
    },
    "fn_concat": {
      "type": "object",
      "title": "Concatenate",
      "properties": {
        "function": {
          "type": "string",
          "template": "concat"
        },
        "args": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/param"
          },
          "additionalItems": false,
          "minItems": 1
        }
      }
    },
    "fn_implode": {
      "type": "object",
      "title": "Implode",
      "properties": {
        "function": {
          "type": "string",
          "template": "implode"
        },
        "args": {
          "type": "array",
          "items": [
            {
              "type": "string",
              "title": "Glue"
            }
          ],
          "additionalItems": {
            "title": "Data",
            "$ref": "#/definitions/param"
          },
          "minItems": 1
        }
      }
    },
    "attr": {
      "type": "object",
      "title": "Attribute",
      "properties": {
        "attr": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "time": {
      "type": "object",
      "title": "Time value",
      "properties": {
        "time": {
          "type": "string",
          "enum": [
            "previousStart",
            "currentStart"
          ],
          "required": true
        }
      },
      "additionalProperties": false
    },
    "param": {
      "oneOf": [
        {
          "type": "string",
          "title": "String"
        },
        {
          "$ref": "#/definitions/function",
          "title": "Function"
        },
        {
          "$ref": "#/definitions/attr",
          "title": "Config attribute"
        },
        {
          "$ref": "#/definitions/time",
          "title": "Time value"
        }
      ]
    }
  },
  "title": "Config",
  "type": "object",
  "properties": {
    "outputBucket": {
      "type": "string",
      "description": "Output bucket for results",
      "minLength": 4,
      "default": false,
      "title": "Output SAPI bucket"
    },
    "debug": {
      "type": "boolean",
      "description": "Print out all requests to API",
      "default": false,
      "title": "Debug mode"
    },
    "incrementalOutput": {
      "type": "boolean",
      "description": "Set results to be stored incrementally",
      "default": false,
      "title": "Incremental Output"
    },
    "jobs": {
      "type": "array",
      "title": "Jobs",
      "uniqueItems": true,
      "items": {
        "$ref": "#/definitions/job"
      }
    }
  }
}
